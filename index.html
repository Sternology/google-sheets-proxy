<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Client Budget Performance Dashboard</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo, useEffect } = React;

        const ClientBudgetTable = () => {
            const [sortBy, setSortBy] = useState('name');
            const [sortOrder, setSortOrder] = useState('asc');
            const [showPlatformSplit, setShowPlatformSplit] = useState(true);
            const [rawData, setRawData] = useState({});
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState(null);
            const [logs, setLogs] = useState([]);
            const [autoRefresh, setAutoRefresh] = useState(false);

            // Configuration
            const PROXY_URL = 'https://sheets-proxy-ria9.vercel.app/api/sheets-proxy';
            const SPREADSHEET_ID = '1nbVrRxhIh2RLa5qtOsaM1N_UmqljztVwxPbQRCnkBcs';
            const API_KEY = 'AIzaSyDffl5VtZDXxAMJ-Cnbay7CbO-PPfF42fI';
            const VERSION = 'v2.2.4'; // Updated client names to show HC-One instead of Care Always On

            // Get current reporting period for each client (dynamic)
            const getCurrentPeriod = (clientType) => {
                const today = new Date();
                
                if (clientType === 'apollo') {
                    // Apollo: 26th to 25th cycle
                    const currentMonth = today.getMonth();
                    const currentYear = today.getFullYear();
                    const day = today.getDate();
                    
                    let startMonth, startYear, endMonth, endYear;
                    
                    if (day >= 26) {
                        // We're in the new period (26th onwards)
                        startMonth = currentMonth;
                        startYear = currentYear;
                        endMonth = currentMonth + 1;
                        endYear = currentYear;
                    } else {
                        // We're still in the previous period (before 26th)
                        startMonth = currentMonth - 1;
                        startYear = currentYear;
                        endMonth = currentMonth;
                        endYear = currentYear;
                    }
                    
                    // Handle year rollover
                    if (startMonth < 0) {
                        startMonth = 11;
                        startYear--;
                    }
                    if (endMonth > 11) {
                        endMonth = 0;
                        endYear++;
                    }
                    
                    const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                    return `${monthNames[startMonth]} 26 - ${monthNames[endMonth]} 25`;
                } else if (clientType === 'hc1') {
                    // HC1: 11th to 10th cycle
                    const currentMonth = today.getMonth();
                    const currentYear = today.getFullYear();
                    const day = today.getDate();
                    
                    let startMonth, startYear, endMonth, endYear;
                    
                    if (day >= 11) {
                        // We're in the new period (11th onwards)
                        startMonth = currentMonth;
                        startYear = currentYear;
                        endMonth = currentMonth + 1;
                        endYear = currentYear;
                    } else {
                        // We're still in the previous period (before 11th)
                        startMonth = currentMonth - 1;
                        startYear = currentYear;
                        endMonth = currentMonth;
                        endYear = currentYear;
                    }
                    
                    // Handle year rollover
                    if (startMonth < 0) {
                        startMonth = 11;
                        startYear--;
                    }
                    if (endMonth > 11) {
                        endMonth = 0;
                        endYear++;
                    }
                    
                    const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                    return `${monthNames[startMonth]} 11 - ${monthNames[endMonth]} 10`;
                } else {
                    // Others: 1st to end of month cycle
                    const currentMonth = today.getMonth();
                    const currentYear = today.getFullYear();
                    const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                    const currentMonthName = monthNames[currentMonth];
                    const lastDay = new Date(currentYear, currentMonth + 1, 0).getDate();
                    
                    return `${currentMonthName} 1 - ${currentMonthName} ${lastDay}`;
                }
            };

            // Get total days for the period
            const getTotalDays = (clientType) => {
                if (clientType === 'apollo') {
                    return 30; // 26th to 25th = 30 days
                } else if (clientType === 'hc1') {
                    return 30; // 11th to 10th = 30 days
                } else {
                    const today = new Date();
                    return new Date(today.getFullYear(), today.getMonth() + 1, 0).getDate();
                }
            };

            // Client and campaign configuration
            const clientConfig = {
                'Apollo': {
                    campaigns: ['*'],
                    budget: 1221,
                    period: getCurrentPeriod('apollo'), // 26th to 25th cycle
                    totalDays: getTotalDays('apollo'),
                    note: 'Budget increased to Â£60/day each platform - showing improvement!'
                },
                'Cygnet Care': {
                    campaigns: ['Care and Support Always On Performance Max', 'Care and Support Always On - Conversions 2025', 'Care and Support Always On - Traffic - 2024'],
                    budget: 800,
                    period: getCurrentPeriod('standard'), // 1st to end of month
                    totalDays: getTotalDays('standard'),
                    tabPrefix: 'Cygnet'
                },
                'Cygnet Nursing': {
                    campaigns: ['Nursing always on Performance Max', 'Always On Nursing Search', 'Nursing Always on April 2024'],
                    budget: 800,
                    period: getCurrentPeriod('standard'), // 1st to end of month
                    totalDays: getTotalDays('standard'),
                    tabPrefix: 'Cygnet',
                    skipTabs: true
                },
                'HC-One - England/Wales': {
                    campaigns: ['AL -  Always on Care Search Campaign', 'Always on Care', 'HC-One Always On Campaign'], // Google + Facebook campaigns
                    budget: 1800,
                    period: getCurrentPeriod('hc1'), // 11th to 10th cycle
                    totalDays: getTotalDays('hc1'),
                    tabPrefix: 'HC1'
                },
                'HC-One - Scotland': {
                    campaigns: ['AL - Scotland Always on Care Search Campaign', 'Always on Care â€“ Scotland'], // Google + Facebook campaigns
                    budget: 1000,
                    period: getCurrentPeriod('hc1'), // 11th to 10th cycle
                    totalDays: getTotalDays('hc1'),
                    tabPrefix: 'HC1',
                    skipTabs: true
                }
            };

            // Utility functions
            const addLog = (message, type = 'info') => {
                const timestamp = new Date().toLocaleTimeString();
                // Limit logs to prevent browser crashes
                setLogs(prev => {
                    const newLogs = [...prev, { timestamp, message, type }];
                    return newLogs.slice(-100); // Keep only last 100 logs
                });
                console.log(`[${timestamp}] ${message}`);
            };

            const clearLogs = () => {
                setLogs([]);
            };

            const parseDateRange = (dateRange) => {
                const parts = dateRange.split(' - ');
                if (parts.length !== 2) return { start: null, end: null };
                
                const currentYear = new Date().getFullYear();
                const parseDate = (dateStr) => {
                    const [month, day] = dateStr.split(' ');
                    const monthMap = {
                        'Jan': 0, 'Feb': 1, 'Mar': 2, 'Apr': 3, 'May': 4, 'Jun': 5,
                        'Jul': 6, 'Aug': 7, 'Sep': 8, 'Oct': 9, 'Nov': 10, 'Dec': 11
                    };
                    return new Date(currentYear, monthMap[month], parseInt(day));
                };
                
                return {
                    start: parseDate(parts[0]),
                    end: parseDate(parts[1])
                };
            };

            const isDateInRange = (date, startDate, endDate) => {
                const checkDate = new Date(date);
                return checkDate >= startDate && checkDate <= endDate;
            };

            // Load data from proxy
            const loadData = async () => {
                clearLogs();
                addLog('Starting data load process...', 'info');
                setLoading(true);
                setError(null);

                try {
                    const allData = {};
                    // Hardcoded expected tabs to ensure all are loaded
                    const expectedTabs = ['Apollo Google', 'Apollo FB', 'Cygnet Google', 'Cygnet FB', 'HC1 Google', 'HC1 FB'];

                    addLog(`Expected tabs: ${expectedTabs.join(', ')}`, 'info');

                    let successCount = 0;
                    let errorCount = 0;

                    // Fetch data from each tab
                    for (const tabName of expectedTabs) {
                        try {
                            addLog(`Fetching data from tab: ${tabName}`, 'info');
                            
                            const url = `${PROXY_URL}?spreadsheetId=${SPREADSHEET_ID}&range=${encodeURIComponent(tabName)}!A:C&apiKey=${API_KEY}`;
                            
                            const response = await fetch(url);
                            
                            addLog(`Response status for ${tabName}: ${response.status}`, response.ok ? 'success' : 'error');
                            
                            if (response.ok) {
                                const data = await response.json();
                                
                                if (data.values && data.values.length > 1) {
                                    const headers = data.values[0];
                                    const rows = data.values.slice(1);
                                    
                                    addLog(`Headers for ${tabName}: ${headers.join(', ')}`, 'info');
                                    
                                    const tabData = rows.map(row => {
                                        const rowData = {};
                                        headers.forEach((header, index) => {
                                            // Map Facebook tab column names to standard format
                                            if (tabName === 'Apollo FB' || tabName === 'Cygnet FB' || tabName === 'HC1 FB') {
                                                if (header === 'Campaign name') {
                                                    rowData['Campaign'] = row[index] || '';
                                                } else if (header === 'Amount spent (GBP)') {
                                                    rowData['Cost'] = row[index] || '';
                                                } else {
                                                    rowData[header] = row[index] || '';
                                                }
                                            } else {
                                                rowData[header] = row[index] || '';
                                            }
                                        });
                                        return rowData;
                                    });
                                    
                                    allData[tabName] = tabData;
                                    successCount++;
                                    addLog(`âœ… Loaded ${tabData.length} rows from ${tabName}`, 'success');
                                } else {
                                    errorCount++;
                                    addLog(`âš ï¸ No data found in tab: ${tabName}`, 'warning');
                                }
                            } else {
                                errorCount++;
                                const errorText = await response.text();
                                addLog(`âŒ Could not fetch tab: ${tabName} (${response.status}) - ${errorText}`, 'error');
                            }
                        } catch (tabError) {
                            errorCount++;
                            addLog(`âŒ Error fetching tab ${tabName}: ${tabError.message}`, 'error');
                        }
                    }

                    if (Object.keys(allData).length === 0) {
                        throw new Error('No data could be loaded from any tabs');
                    }

                    setRawData(allData);
                    addLog(`ðŸŽ‰ Data loading complete! Loaded ${Object.keys(allData).length} tabs`, 'success');

                } catch (err) {
                    setError(err.message);
                    addLog(`ðŸ’¥ Fatal error: ${err.message}`, 'error');
                } finally {
                    setLoading(false);
                    addLog('Load process finished', 'info');
                }
            };

            // Process raw data into client metrics
            const processRawData = (data) => {
                const today = new Date();
                const processedClients = [];

                Object.keys(clientConfig).forEach(clientName => {
                    const config = clientConfig[clientName];
                    const tabPrefix = config.tabPrefix || clientName;
                    const { start: periodStart, end: periodEnd } = parseDateRange(config.period);
                    
                    if (!periodStart || !periodEnd) return;

                    const daysElapsed = Math.ceil((today - periodStart) / (1000 * 60 * 60 * 24)) + 1;
                    const daysLeft = Math.max(0, Math.ceil((periodEnd - today) / (1000 * 60 * 60 * 24)));

                    let googleSpend = 0;
                    let facebookSpend = 0;

                    // Process Google data
                    const googleTabName = `${tabPrefix} Google`;
                    if (data[googleTabName]) {
                        let clientGoogleSpend = 0;
                        data[googleTabName].forEach(row => {
                            const rowDate = new Date(row.Date);
                            const campaign = row.Campaign || '';
                            const cost = parseFloat(row.Cost) || 0;

                            const matchesCampaign = config.campaigns.includes('*') || 
                                                 config.campaigns.some(c => campaign.includes(c));

                            if (matchesCampaign && isDateInRange(rowDate, periodStart, periodEnd)) {
                                clientGoogleSpend += cost;
                            }
                        });
                        googleSpend = clientGoogleSpend;
                    }

                    // Process Facebook data  
                    const facebookTabName = `${tabPrefix} FB`;
                    if (data[facebookTabName]) {
                        let clientFacebookSpend = 0;
                        data[facebookTabName].forEach(row => {
                            const rowDate = new Date(row.Date);
                            const campaign = row.Campaign || '';
                            const cost = parseFloat(row.Cost) || 0;

                            const matchesCampaign = config.campaigns.includes('*') || 
                                                 config.campaigns.some(c => campaign.includes(c));

                            if (matchesCampaign && isDateInRange(rowDate, periodStart, periodEnd)) {
                                clientFacebookSpend += cost;
                            }
                        });
                        facebookSpend = clientFacebookSpend;
                    }

                    const total = googleSpend + facebookSpend;
                    const used = (total / config.budget) * 100;
                    const remaining = config.budget - total;
                    const expectedSpend = config.budget * (daysElapsed / config.totalDays);
                    const currentDaily = daysElapsed > 0 ? total / daysElapsed : 0;
                    const variance = total - expectedSpend;
                    const pace = expectedSpend > 0 ? (total / expectedSpend) * 100 : 100;
                    const requiredDaily = daysLeft > 0 ? remaining / daysLeft : 0;

                    let status = 'ON TRACK';
                    if (pace < 85) status = 'COLD';
                    else if (pace > 115) status = 'HOT';

                    processedClients.push({
                        name: clientName,
                        google: googleSpend,
                        facebook: facebookSpend,
                        total: total,
                        budget: config.budget,
                        period: config.period,
                        totalDays: config.totalDays,
                        daysElapsed: daysElapsed,
                        daysLeft: daysLeft,
                        used: used,
                        remaining: remaining,
                        googlePercent: total > 0 ? (googleSpend / total) * 100 : 0,
                        facebookPercent: total > 0 ? (facebookSpend / total) * 100 : 0,
                        expectedSpend: expectedSpend,
                        currentDaily: currentDaily,
                        variance: variance,
                        pace: pace,
                        requiredDaily: requiredDaily,
                        status: status,
                        note: config.note || ''
                    });
                });

                return processedClients;
            };

            // Auto-refresh effect
            useEffect(() => {
                if (autoRefresh) {
                    const interval = setInterval(loadData, 5 * 60 * 1000); // 5 minutes
                    return () => clearInterval(interval);
                }
            }, [autoRefresh]);

            // Load data on mount
            useEffect(() => {
                loadData();
            }, []);

            const dataToUse = Object.keys(rawData).length > 0 ? processRawData(rawData) : [];

            const sortedData = useMemo(() => {
                const sorted = [...dataToUse].sort((a, b) => {
                    let aVal = a[sortBy];
                    let bVal = b[sortBy];
                    
                    if (typeof aVal === 'string') {
                        aVal = aVal.toLowerCase();
                        bVal = bVal.toLowerCase();
                    }
                    
                    if (sortOrder === 'asc') {
                        return aVal < bVal ? -1 : aVal > bVal ? 1 : 0;
                    } else {
                        return aVal > bVal ? -1 : aVal < bVal ? 1 : 0;
                    }
                });
                return sorted;
            }, [dataToUse, sortBy, sortOrder]);

            const handleSort = (field) => {
                if (sortBy === field) {
                    setSortOrder(sortOrder === 'asc' ? 'desc' : 'asc');
                } else {
                    setSortBy(field);
                    setSortOrder('asc');
                }
            };

            const getStatusColor = (status) => {
                if (status === 'COLD') return 'bg-blue-100 text-blue-800 border-blue-200';
                if (status === 'HOT') return 'bg-red-100 text-red-800 border-red-200';
                if (status === 'ON TRACK') return 'bg-green-100 text-green-800 border-green-200';
                return 'bg-gray-100 text-gray-800 border-gray-200';
            };

            const getPaceColor = (pace) => {
                if (pace < 85) return 'text-blue-600 font-bold';
                if (pace > 115) return 'text-red-600 font-bold';
                return 'text-green-600 font-bold';
            };

            const getUsageColor = (used) => {
                if (used < 40) return 'text-blue-600';
                if (used > 80) return 'text-red-600';
                return 'text-green-600';
            };

            const getDaysLeftColor = (daysLeft) => {
                if (daysLeft <= 2) return 'text-red-600 font-bold bg-red-50 px-2 py-1 rounded';
                if (daysLeft <= 7) return 'text-orange-600 font-medium';
                return 'text-gray-700';
            };

            const totalSpend = dataToUse.reduce((sum, client) => sum + client.total, 0);
            const totalBudget = dataToUse.reduce((sum, client) => sum + client.budget, 0);
            const totalGoogle = dataToUse.reduce((sum, client) => sum + client.google, 0);
            const totalFacebook = dataToUse.reduce((sum, client) => sum + client.facebook, 0);

            const statusCounts = dataToUse.reduce((acc, client) => {
                acc[client.status] = (acc[client.status] || 0) + 1;
                return acc;
            }, {});

            const SortIcon = ({ field }) => {
                if (sortBy !== field) return React.createElement('span', { className: 'text-gray-400' }, 'â†•ï¸');
                return React.createElement('span', { className: 'text-blue-600' }, sortOrder === 'asc' ? 'â†‘' : 'â†“');
            };

            return React.createElement('div', { className: 'w-full min-h-screen bg-gray-50 p-4' },
                React.createElement('div', { className: 'max-w-full mx-auto' },
                    // Header
                    React.createElement('div', { className: 'bg-white rounded-lg shadow-sm p-6 mb-6' },
                        React.createElement('div', { className: 'flex flex-col lg:flex-row lg:items-center lg:justify-between' },
                            React.createElement('div', null,
                                React.createElement('h1', { className: 'text-3xl font-bold text-gray-900 mb-2' }, 'Client Budget Performance Dashboard'),
                                React.createElement('p', { className: 'text-gray-600' }, 
                                    Object.keys(rawData).length > 0 ? 'Data loaded from Google Sheets' : 'Loading...', 
                                    ' | Updated: ', new Date().toLocaleString(),
                                    ' | ', VERSION
                                ),
                                loading && React.createElement('p', { className: 'text-sm text-blue-600 mt-1' }, 'ðŸ”„ Loading data...'),
                                error && React.createElement('p', { className: 'text-sm text-red-600 mt-1' }, 'âŒ ', error),
                                Object.keys(rawData).length > 0 && React.createElement('p', { className: 'text-sm text-green-600 mt-1' }, 'âœ… Processing ', Object.keys(rawData).length, ' data tabs')
                            ),
                            // Summary Cards
                            React.createElement('div', { className: 'mt-4 lg:mt-0 grid grid-cols-2 lg:grid-cols-4 gap-4 text-center' },
                                React.createElement('div', { className: 'bg-blue-50 p-4 rounded-lg' },
                                    React.createElement('div', { className: 'text-2xl font-bold text-blue-600' }, 'Â£', totalSpend.toFixed(0)),
                                    React.createElement('div', { className: 'text-sm text-blue-700' }, 'Total Spend')
                                ),
                                React.createElement('div', { className: 'bg-green-50 p-4 rounded-lg' },
                                    React.createElement('div', { className: 'text-2xl font-bold text-green-600' }, statusCounts['ON TRACK'] || 0),
                                    React.createElement('div', { className: 'text-sm text-green-700' }, 'On Track')
                                ),
                                React.createElement('div', { className: 'bg-orange-50 p-4 rounded-lg' },
                                    React.createElement('div', { className: 'text-2xl font-bold text-orange-600' }, totalSpend > 0 ? ((totalGoogle/totalSpend)*100).toFixed(0) : 0, '%'),
                                    React.createElement('div', { className: 'text-sm text-orange-700' }, 'Google')
                                ),
                                React.createElement('div', { className: 'bg-purple-50 p-4 rounded-lg' },
                                    React.createElement('div', { className: 'text-2xl font-bold text-purple-600' }, totalSpend > 0 ? ((totalFacebook/totalSpend)*100).toFixed(0) : 0, '%'),
                                    React.createElement('div', { className: 'text-sm text-purple-700' }, 'Meta/FB')
                                )
                            )
                        ),
                        // Controls
                        React.createElement('div', { className: 'mt-6 flex flex-wrap items-center gap-4' },
                            React.createElement('label', { className: 'flex items-center' },
                                React.createElement('input', {
                                    type: 'checkbox',
                                    checked: showPlatformSplit,
                                    onChange: (e) => setShowPlatformSplit(e.target.checked),
                                    className: 'mr-2'
                                }),
                                React.createElement('span', { className: 'text-sm text-gray-700' }, 'Show Platform Split')
                            ),
                            React.createElement('label', { className: 'flex items-center' },
                                React.createElement('input', {
                                    type: 'checkbox',
                                    checked: autoRefresh,
                                    onChange: (e) => setAutoRefresh(e.target.checked),
                                    className: 'mr-2'
                                }),
                                React.createElement('span', { className: 'text-sm text-gray-700' }, 'Auto-refresh (5 min)')
                            ),
                            React.createElement('button', {
                                onClick: loadData,
                                disabled: loading,
                                className: 'px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 transition-colors text-sm'
                            }, loading ? 'Loading...' : 'ðŸ”„ Refresh Data'),
                            React.createElement('button', {
                                onClick: clearLogs,
                                className: 'px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors text-sm'
                            }, 'Clear Logs')
                        ),
                        // Logs Display
                        logs.length > 0 && React.createElement('div', { className: 'mt-4' },
                            React.createElement('h4', { className: 'text-sm font-medium text-gray-800 mb-2' }, 'System Logs:'),
                            React.createElement('div', { className: 'bg-gray-900 text-green-400 p-3 rounded max-h-32 overflow-y-auto font-mono text-xs' },
                                logs.slice(-20).map((log, index) =>
                                    React.createElement('div', {
                                        key: index,
                                        className: log.type === 'error' ? 'text-red-400' : 
                                                 log.type === 'success' ? 'text-green-400' : 
                                                 log.type === 'warning' ? 'text-yellow-400' : 
                                                 log.type === 'debug' ? 'text-gray-400' : 'text-blue-400'
                                    }, `[${log.timestamp}] ${log.message}`)
                                )
                            )
                        )
                    ),
                    // Main Dashboard Content with Visual Gauges
                    React.createElement('div', { className: 'bg-white rounded-lg shadow-sm p-6' },
                        React.createElement('h2', { className: 'text-2xl font-bold mb-6 text-center' }, 'Budget Performance Dashboard'),
                        dataToUse.length > 0 ? 
                            React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6' },
                                dataToUse.map(client => {
                                    const usagePercent = Math.min(client.used, 100);
                                    const remainingPercent = Math.max(0, 100 - usagePercent);
                                    
                                    // Determine gauge colors based on usage
                                    const getGaugeColor = (usage, pace) => {
                                        if (usage >= 90) return 'from-red-500 to-red-600';
                                        if (usage >= 75) return 'from-orange-500 to-orange-600'; 
                                        if (pace < 85) return 'from-blue-500 to-blue-600';
                                        return 'from-green-500 to-green-600';
                                    };
                                    
                                    const getBorderColor = (status) => {
                                        if (status === 'HOT') return 'border-red-300 bg-red-50';
                                        if (status === 'COLD') return 'border-blue-300 bg-blue-50';
                                        return 'border-green-300 bg-green-50';
                                    };
                                    
                                    // Pace gauge positioning (0-200% mapped to circle)
                                    const pacePercent = Math.min(Math.max(client.pace, 0), 200);
                                    const pacePosition = pacePercent / 200; // 0 to 1
                                    
                                    const getPaceNeedleColor = (pace) => {
                                        if (pace < 85) return '#3B82F6'; // Blue
                                        if (pace > 115) return '#EF4444'; // Red
                                        return '#10B981'; // Green
                                    };
                                    
                                    return React.createElement('div', { 
                                        key: client.name,
                                        className: `border-2 rounded-xl p-6 transition-all hover:shadow-lg ${getBorderColor(client.status)}`
                                    },
                                        // Client Name and Status
                                        React.createElement('div', { className: 'flex justify-between items-start mb-4' },
                                            React.createElement('h3', { className: 'font-bold text-lg text-gray-900' }, client.name),
                                            React.createElement('span', { 
                                                className: `px-3 py-1 rounded-full text-xs font-bold ${getStatusColor(client.status)}`
                                            }, 
                                                client.status === 'ON TRACK' ? 'âœ… ON TRACK' : 
                                                client.status === 'HOT' ? 'ðŸ”¥ HOT' : 'ðŸ§Š COLD'
                                            )
                                        ),
                                        
                                        // Dual Gauge Display
                                        React.createElement('div', { className: 'flex justify-center items-center gap-4 mb-6' },
                                            // Budget Usage Gauge (Left)
                                            React.createElement('div', { className: 'relative w-24 h-24' },
                                                React.createElement('svg', { className: 'w-24 h-24 transform -rotate-90' },
                                                    React.createElement('circle', {
                                                        cx: '48',
                                                        cy: '48', 
                                                        r: '40',
                                                        stroke: '#e5e7eb',
                                                        strokeWidth: '6',
                                                        fill: 'transparent'
                                                    }),
                                                    React.createElement('circle', {
                                                        cx: '48',
                                                        cy: '48',
                                                        r: '40', 
                                                        stroke: 'url(#budget-gradient-' + client.name.replace(/[^a-zA-Z0-9]/g, '') + ')',
                                                        strokeWidth: '6',
                                                        fill: 'transparent',
                                                        strokeDasharray: '251.2',
                                                        strokeDashoffset: 251.2 * (1 - usagePercent / 100),
                                                        strokeLinecap: 'round',
                                                        className: 'transition-all duration-1000 ease-out'
                                                    }),
                                                    React.createElement('defs', null,
                                                        React.createElement('linearGradient', {
                                                            id: 'budget-gradient-' + client.name.replace(/[^a-zA-Z0-9]/g, ''),
                                                            x1: '0%', y1: '0%', x2: '100%', y2: '0%'
                                                        },
                                                            React.createElement('stop', { offset: '0%', stopColor: getGaugeColor(client.used, client.pace).split(' ')[0].replace('from-', '') }),
                                                            React.createElement('stop', { offset: '100%', stopColor: getGaugeColor(client.used, client.pace).split(' ')[1].replace('to-', '') })
                                                        )
                                                    )
                                                ),
                                                React.createElement('div', { className: 'absolute inset-0 flex flex-col items-center justify-center' },
                                                    React.createElement('div', { className: `text-lg font-bold ${getUsageColor(client.used)}` }, 
                                                        client.used.toFixed(0), '%'
                                                    ),
                                                    React.createElement('div', { className: 'text-xs text-gray-500' }, 'Budget')
                                                )
                                            ),
                                            
                                            // Pace Temperature Gauge (Right)
                                            React.createElement('div', { className: 'relative w-24 h-24' },
                                                React.createElement('svg', { className: 'w-24 h-24 transform -rotate-90' },
                                                    React.createElement('circle', {
                                                        cx: '48',
                                                        cy: '48', 
                                                        r: '40',
                                                        stroke: 'url(#pace-bg-gradient)',
                                                        strokeWidth: '6',
                                                        fill: 'transparent'
                                                    }),
                                                    // Pace needle
                                                    React.createElement('circle', {
                                                        cx: '48',
                                                        cy: '48',
                                                        r: '40', 
                                                        stroke: getPaceNeedleColor(client.pace),
                                                        strokeWidth: '6',
                                                        fill: 'transparent',
                                                        strokeDasharray: '251.2',
                                                        strokeDashoffset: 251.2 * (1 - pacePosition),
                                                        strokeLinecap: 'round',
                                                        className: 'transition-all duration-1000 ease-out'
                                                    }),
                                                    React.createElement('defs', null,
                                                        React.createElement('linearGradient', {
                                                            id: 'pace-bg-gradient',
                                                            x1: '0%', y1: '0%', x2: '100%', y2: '0%'
                                                        },
                                                            React.createElement('stop', { offset: '0%', stopColor: '#3B82F6' }),   // Blue (cold)
                                                            React.createElement('stop', { offset: '50%', stopColor: '#10B981' }),  // Green (perfect)
                                                            React.createElement('stop', { offset: '100%', stopColor: '#EF4444' }) // Red (hot)
                                                        )
                                                    )
                                                ),
                                                React.createElement('div', { className: 'absolute inset-0 flex flex-col items-center justify-center' },
                                                    React.createElement('div', { className: `text-lg font-bold ${getPaceColor(client.pace)}` }, 
                                                        client.pace.toFixed(0), '%'
                                                    ),
                                                    React.createElement('div', { className: 'text-xs text-gray-500' }, 'Pace')
                                                )
                                            )
                                        ),
                                        
                                        // Financial Details
                                        React.createElement('div', { className: 'space-y-3' },
                                            React.createElement('div', { className: 'flex justify-between items-center' },
                                                React.createElement('span', { className: 'text-sm text-gray-600' }, 'Total Spend'),
                                                React.createElement('span', { className: 'font-bold text-lg' }, 'Â£', client.total.toFixed(0))
                                            ),
                                            React.createElement('div', { className: 'flex justify-between items-center' },
                                                React.createElement('span', { className: 'text-sm text-gray-600' }, 'Budget'),
                                                React.createElement('span', { className: 'font-semibold' }, 'Â£', client.budget)
                                            ),
                                            React.createElement('div', { className: 'flex justify-between items-center' },
                                                React.createElement('span', { className: 'text-sm text-gray-600' }, 'Remaining'),
                                                React.createElement('span', { className: `font-semibold ${client.remaining > 0 ? 'text-green-600' : 'text-red-600'}` }, 
                                                    'Â£', client.remaining.toFixed(0)
                                                )
                                            ),
                                            React.createElement('div', { className: 'flex justify-between items-center' },
                                                React.createElement('span', { className: 'text-sm text-gray-600' }, 'Daily Average'),
                                                React.createElement('span', { className: 'font-semibold' }, 'Â£', client.currentDaily.toFixed(0))
                                            ),
                                            // Platform Split (when enabled)
                                            showPlatformSplit && (client.google > 0 || client.facebook > 0) && React.createElement('div', { className: 'border-t pt-3 mt-3' },
                                                React.createElement('div', { className: 'flex justify-between items-center mb-2' },
                                                    React.createElement('span', { className: 'text-sm text-gray-600' }, 'Google'),
                                                    React.createElement('span', { className: 'font-semibold text-orange-600' }, 'Â£', client.google.toFixed(0), ' (', client.googlePercent.toFixed(0), '%)')
                                                ),
                                                React.createElement('div', { className: 'flex justify-between items-center' },
                                                    React.createElement('span', { className: 'text-sm text-gray-600' }, 'Meta/FB'),
                                                    React.createElement('span', { className: 'font-semibold text-purple-600' }, 'Â£', client.facebook.toFixed(0), ' (', client.facebookPercent.toFixed(0), '%)')
                                                )
                                            )
                                        ),
                                        
                                        // Progress Bar
                                        React.createElement('div', { className: 'mt-4' },
                                            React.createElement('div', { className: 'flex justify-between text-xs text-gray-500 mb-1' },
                                                React.createElement('span', null, 'Days Progress'),
                                                React.createElement('span', null, client.daysElapsed, ' / ', client.totalDays, ' days')
                                            ),
                                            React.createElement('div', { className: 'w-full bg-gray-200 rounded-full h-2' },
                                                React.createElement('div', {
                                                    className: 'bg-blue-500 h-2 rounded-full transition-all duration-1000',
                                                    style: { width: (client.daysElapsed / client.totalDays * 100) + '%' }
                                                })
                                            )
                                        ),
                                        
                                        // Days Left Alert
                                        client.daysLeft <= 7 && React.createElement('div', { 
                                            className: `mt-4 p-3 rounded-lg text-center ${
                                                client.daysLeft <= 2 ? 'bg-red-100 text-red-800' :
                                                client.daysLeft <= 5 ? 'bg-orange-100 text-orange-800' :
                                                'bg-yellow-100 text-yellow-800'
                                            }`
                                        },
                                            React.createElement('div', { className: 'font-bold' }, 
                                                client.daysLeft <= 1 ? 'ðŸš¨ ENDS TODAY!' :
                                                client.daysLeft === 2 ? 'âš ï¸ ENDS TOMORROW!' :
                                                client.daysLeft + ' days left'
                                            ),
                                            React.createElement('div', { className: 'text-sm mt-1' }, 
                                                'Need Â£', client.requiredDaily.toFixed(0), '/day to finish on budget'
                                            )
                                        ),
                                        
                                        // Pace Indicator
                                        React.createElement('div', { className: 'mt-4 text-center' },
                                            React.createElement('div', { className: `text-sm font-semibold ${getPaceColor(client.pace)}` },
                                                'Pace: ', client.pace.toFixed(0), '%'
                                            ),
                                            React.createElement('div', { className: 'text-xs text-gray-500' },
                                                client.pace > 115 ? 'Spending too fast' :
                                                client.pace < 85 ? 'Spending too slow' :
                                                'Perfect pace'
                                            )
                                        )
                                    );
                                })
                            ) :
                            React.createElement('div', { className: 'text-center py-12' },
                                React.createElement('div', { className: 'animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4' }),
                                React.createElement('p', { className: 'text-gray-500 text-lg' }, 'Loading budget data...')
                            )
                    )
                )
            );
        };

        ReactDOM.render(React.createElement(ClientBudgetTable), document.getElementById('root'));
    </script>
</body>
</html>
